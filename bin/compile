#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

set -euo pipefail

# Install AWS CLI
echo "Downloading AWS CLI..."

curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip

mkdir aws-cli
mkdir aws-cli/bin

echo "Installing AWS CLI..."
./aws/install -i aws-cli -b aws-cli/bin

#echo $SHELL

chmod -R 755 aws-cli

aws-cli/bin/aws --version

# By specifying the static directory, we can sync only the static files and to the correct directory in the application
S3_BUCKET="s3://housekeep-legacy-styles/static/"

# Define the local directory where you want to store the files
STATIC_DIR="$BUILD_DIR/housekeep/static/"

# Make sure we're at the root level
cd "$BUILD_DIR" || exit

# Make sure the local directory exists
mkdir -p "$STATIC_DIR"

echo "Syncing static files..."

# Use AWS CLI to sync the S3 bucket to the local directory
aws-cli/bin/aws s3 sync "$S3_BUCKET" "$STATIC_DIR" --no-sign-request

echo "Syncing complete"

# --no-sign-request tells AWS CLI that the bucket is public and does not require credentials
